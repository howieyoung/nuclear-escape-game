(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[169],{9169:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return q}});var r,l,o,a,i=t(3827),u=t(4090);function c(e,n){return Object.freeze({...e,...n})}let s=(0,u.createContext)(null),d=s.Provider;function f(){let e=(0,u.useContext)(s);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function p(){return f().map}var h=t(9542);function x(e){return(0,u.forwardRef)(function(n,t){let{instance:r,context:l}=e(n).current;return(0,u.useImperativeHandle)(t,()=>r),null==n.children?null:u.createElement(d,{value:l},n.children)})}function m(e,n,t){return Object.freeze({instance:e,context:n,container:t})}function v(e,n){return null==n?function(n,t){let r=(0,u.useRef)();return r.current||(r.current=e(n,t)),r}:function(t,r){let l=(0,u.useRef)();l.current||(l.current=e(t,r));let o=(0,u.useRef)(t),{instance:a}=l.current;return(0,u.useEffect)(function(){o.current!==t&&(n(a,t,o.current),o.current=t)},[a,t,r]),l}}function g(e,n){let t=(0,u.useRef)(n);(0,u.useEffect)(function(){n!==t.current&&null!=e.attributionControl&&(null!=t.current&&e.attributionControl.removeAttribution(t.current),null!=n&&e.attributionControl.addAttribution(n)),t.current=n},[e,n])}function b(e,n){let t=(0,u.useRef)();(0,u.useEffect)(function(){return null!=n&&e.instance.on(n),t.current=n,function(){null!=t.current&&e.instance.off(t.current),t.current=null}},[e,n])}function y(e,n){var t;let r=null!==(t=e.pane)&&void 0!==t?t:n.pane;return r?{...e,pane:r}:e}function j(e,n){(0,u.useEffect)(function(){var t;return(null!==(t=n.layerContainer)&&void 0!==t?t:n.map).addLayer(e.instance),function(){var t;null===(t=n.layerContainer)||void 0===t||t.removeLayer(e.instance),n.map.removeLayer(e.instance)}},[n,e])}function w(e){return function(n){let t=f(),r=e(y(n,t),t);return g(t.map,n.attribution),b(r.current,n.eventHandlers),j(r.current,t),r}}function C(e,n){var t;return x((t=v(e,n),function(e){let n=f(),r=t(y(e,n),n);return b(r.current,e.eventHandlers),j(r.current,n),function(e,n){let t=(0,u.useRef)();(0,u.useEffect)(function(){if(n.pathOptions!==t.current){var r;let l=null!==(r=n.pathOptions)&&void 0!==r?r:{};e.instance.setStyle(l),t.current=l}},[e,n])}(r.current,e),r}))}var N=t(6461),M=t.n(N);let O=C(function(e,n){let{positions:t,...r}=e,l=new N.Polygon(t,r);return m(l,c(n,{overlayContainer:l}))},function(e,n,t){n.positions!==t.positions&&e.setLatLngs(n.positions)}),E=C(function(e,n){let{center:t,children:r,...l}=e,o=new N.Circle(t,l);return m(o,c(n,{overlayContainer:o}))},function(e,n,t){n.center!==t.center&&e.setLatLng(n.center),null!=n.radius&&n.radius!==t.radius&&e.setRadius(n.radius)});function z(){return(z=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}let I=(0,u.forwardRef)(function(e,n){let{bounds:t,boundsOptions:r,center:l,children:o,className:a,id:i,placeholder:c,style:s,whenReady:f,zoom:p,...h}=e,[x]=(0,u.useState)({className:a,id:i,style:s}),[m,v]=(0,u.useState)(null);(0,u.useImperativeHandle)(n,()=>{var e;return null!==(e=null==m?void 0:m.map)&&void 0!==e?e:null},[m]);let g=(0,u.useCallback)(e=>{if(null!==e&&null===m){let n=new N.Map(e,h);null!=l&&null!=p?n.setView(l,p):null!=t&&n.fitBounds(t,r),null!=f&&n.whenReady(f),v(Object.freeze({__version:1,map:n}))}},[]);(0,u.useEffect)(()=>()=>{null==m||m.map.remove()},[m]);let b=m?u.createElement(d,{value:m},o):null!=c?c:null;return u.createElement("div",z({},x,{ref:g}),b)}),k=(r=w(v(function(e,n){let{url:t,...r}=e;return m(new N.TileLayer(t,y(r,n)),n)},function(e,n,t){!function(e,n,t){let{opacity:r,zIndex:l}=n;null!=r&&r!==t.opacity&&e.setOpacity(r),null!=l&&l!==t.zIndex&&e.setZIndex(l)}(e,n,t);let{url:r}=n;null!=r&&r!==t.url&&e.setUrl(r)})),(0,u.forwardRef)(function(e,n){let{instance:t}=r(e).current;return(0,u.useImperativeHandle)(n,()=>t),null})),L=x(w(v(function(e,n){let{position:t,...r}=e,l=new N.Marker(t,r);return m(l,c(n,{overlayContainer:l}))},function(e,n,t){n.position!==t.position&&e.setLatLng(n.position),null!=n.icon&&n.icon!==t.icon&&e.setIcon(n.icon),null!=n.zIndexOffset&&n.zIndexOffset!==t.zIndexOffset&&e.setZIndexOffset(n.zIndexOffset),null!=n.opacity&&n.opacity!==t.opacity&&e.setOpacity(n.opacity),null!=e.dragging&&n.draggable!==t.draggable&&(!0===n.draggable?e.dragging.enable():e.dragging.disable())}))),R=(l=v(function(e,n){return m(new N.Popup(e,n.overlayContainer),n)}),o=function(e,n,t,r){let{position:l}=t;(0,u.useEffect)(function(){let{instance:t}=e;function o(e){e.popup===t&&(t.update(),r(!0))}function a(e){e.popup===t&&r(!1)}return n.map.on({popupopen:o,popupclose:a}),null==n.overlayContainer?(null!=l&&t.setLatLng(l),t.openOn(n.map)):n.overlayContainer.bindPopup(t),function(){var e;n.map.off({popupopen:o,popupclose:a}),null===(e=n.overlayContainer)||void 0===e||e.unbindPopup(),n.map.removeLayer(t)}},[e,n,r,l])},a=function(e,n){let t=f(),r=l(y(e,t),t);return g(t.map,e.attribution),b(r.current,e.eventHandlers),o(r.current,t,e,n),r},(0,u.forwardRef)(function(e,n){let[t,r]=(0,u.useState)(!1),{instance:l}=a(e,r).current;(0,u.useImperativeHandle)(n,()=>l),(0,u.useEffect)(function(){t&&l.update()},[l,t,e.children]);let o=l._contentNode;return o?(0,h.createPortal)(e.children,o):null}));var P=t(389);t(9851);let S=M().icon({iconUrl:"".concat("/nuclear-escape-game","/icons/nuclear-plant.svg"),iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[0,-20],className:"nuclear-plant-icon"}),F=M().icon({iconUrl:"".concat("/nuclear-escape-game","/icons/user-location.svg"),iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[0,-20],className:"user-location-icon"});if("undefined"!=typeof document){let e=document.createElement("style");e.textContent="\n  .nuclear-plant-icon {\n    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));\n    transition: transform 0.2s ease;\n  }\n  .nuclear-plant-icon:hover {\n    transform: scale(1.1);\n  }\n  .user-location-icon {\n    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));\n    transition: transform 0.2s ease;\n  }\n  .user-location-icon:hover {\n    transform: scale(1.1);\n  }\n",document.head.appendChild(e)}function H(){let{setPlantLocation:e,setUserLocation:n,isSimulationRunning:t,plantLocation:r}=(0,P.g)(),l=p();return!function(e){let n=p();(0,u.useEffect)(function(){return n.on(e),function(){n.off(e)}},[n,e])}({click:l=>{t||(r?n([l.latlng.lat,l.latlng.lng]):e([l.latlng.lat,l.latlng.lng]))}}),(0,u.useEffect)(()=>{r||t||l.setView([23.5,121],8)},[r,t,l]),null}function _(){let e=p(),{plantLocation:n,isSimulationRunning:t}=(0,P.g)();return(0,u.useEffect)(()=>{n||t||e.setView([23.5,121],8)},[n,t,e]),null}function A(){let{plantLocation:e,windDirection:n,windSpeed:t,simulationTime:r,diffusionMode:l}=(0,P.g)();if(p(),!e||0===r)return null;let o=(0,u.useMemo)(()=>{let o=60*r,a={duration:30,speed:50,diffusionD:2},i=1e3*t/3600,u=(e=>{if(e<=a.duration)return Math.max(1e3,a.speed*e);{let n=a.speed*a.duration,t=Math.sqrt(e/a.duration);return Math.max(1e3,n+Math.sqrt(2*a.diffusionD*(e-a.duration))*t)}})(o),c=[];for(let t=0;t<36;t++){let r;let a=2*t*Math.PI/36;r="natural"===l?u:u+i*o*((.4*Math.cos(a+n*Math.PI/180)+1)/2);let s=e[0]-r*Math.cos(a)/111e3,d=e[1]+r*Math.sin(a)/(111e3*Math.cos(e[0]*Math.PI/180));c.push([s,d])}return c},[e,n,t,r,l]),a=60*r,c={duration:30,speed:50,diffusionD:2},s=(e=>{if(e<=c.duration)return Math.max(1e3,c.speed*e);{let n=c.speed*c.duration,t=Math.sqrt(e/c.duration);return Math.max(1e3,n+Math.sqrt(2*c.diffusionD*(e-c.duration))*t)}})(a),d=1e3*t/3600,f=d*a;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"absolute top-4 right-4 z-[1000] bg-white p-2 rounded shadow",children:(0,i.jsxs)("div",{className:"mt-2 text-sm",children:[(0,i.jsxs)("div",{children:["時間: ",r," 分鐘 (",a," 秒)"]}),(0,i.jsxs)("div",{children:["風速: ",t," km/h (",d.toFixed(2)," m/s)"]}),(0,i.jsxs)("div",{children:["風向: ",n,"\xb0"]}),(0,i.jsxs)("div",{children:["基礎擴散半徑: ",s.toFixed(2)," 公尺"]}),"combined"===l&&(0,i.jsxs)("div",{children:["風向影響距離: ",f.toFixed(2)," 公尺"]})]})}),(0,i.jsx)(O,{positions:o,pathOptions:{fillColor:"#ff0000",fillOpacity:.2,color:"#ff0000",weight:2,opacity:.5}}),(0,i.jsx)(E,{center:e,radius:1e3,pathOptions:{fillColor:"#ff0000",fillOpacity:.4,color:"#ff0000",weight:2,opacity:.8}})]})}function D(){let{simulationTime:e,setSimulationTime:n}=(0,P.g)();return(0,i.jsx)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-[10] bg-white/90 p-2 rounded-lg shadow-lg",children:(0,i.jsx)("div",{className:"flex gap-2",children:[{label:"1小時",value:60},{label:"3小時",value:180},{label:"6小時",value:360},{label:"12小時",value:720},{label:"24小時",value:1440},{label:"36小時",value:2160},{label:"48小時",value:2880}].map(t=>(0,i.jsx)("button",{onClick:()=>n(t.value),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors\n              ".concat(e===t.value?"bg-rose-600 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"),children:t.label},t.value))})})}function q(){let{plantLocation:e,userLocation:n,isSimulationRunning:t,windDirection:r,spreadSpeed:l,simulationTime:o}=(0,P.g)(),a=(0,u.useRef)(null);return(0,i.jsxs)("div",{className:"relative w-full h-[600px]",children:[(0,i.jsxs)(I,{center:[23.5,121],zoom:7,className:"w-full h-full rounded-lg",style:{height:"100%",width:"100%"},ref:a,children:[(0,i.jsx)(k,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,i.jsx)(H,{}),(0,i.jsx)(_,{}),e&&(0,i.jsx)(L,{position:e,icon:S,children:(0,i.jsx)(R,{children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"font-bold",children:"核電廠位置"}),(0,i.jsxs)("div",{children:["緯度: ",e[0].toFixed(4)]}),(0,i.jsxs)("div",{children:["經度: ",e[1].toFixed(4)]})]})})}),n&&(0,i.jsx)(L,{position:n,icon:F,children:(0,i.jsx)(R,{children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"font-bold",children:"您的位置"}),(0,i.jsxs)("div",{children:["緯度: ",n[0].toFixed(4)]}),(0,i.jsxs)("div",{children:["經度: ",n[1].toFixed(4)]})]})})}),e&&o>0&&(0,i.jsx)(A,{}),t&&(0,i.jsxs)("div",{className:"absolute top-4 right-4 bg-white/90 backdrop-blur-sm p-4 rounded-lg shadow-lg z-10",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Simulation Info"}),(0,i.jsxs)("p",{children:["Wind Direction: ",r,"\xb0"]}),(0,i.jsxs)("p",{children:["Spread Speed: ",l,"x"]})]}),!e&&!t&&(0,i.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white/90 backdrop-blur-sm p-4 rounded-lg shadow-lg z-10 text-center",children:(0,i.jsx)("p",{className:"text-gray-700",children:"Click on the map to place a nuclear power plant"})}),e&&!n&&!t&&(0,i.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white/90 backdrop-blur-sm p-4 rounded-lg shadow-lg z-10 text-center",children:(0,i.jsx)("p",{className:"text-gray-700",children:"Click on the map to set your location"})})]}),(0,i.jsx)(D,{})]})}M().Marker.prototype.options.icon=S},9851:function(){}}]);